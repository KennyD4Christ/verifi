{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Finstock Accounting System{% endblock %}</title>
    
    {% block extra_head %}
    <!-- Additional head content can be added here by child templates -->
    {% endblock %}

    <!-- CSS Links -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
</head>
<body>
    <header>
        {% block header %}
        <!-- Header content -->
        {% endblock %}
    </header>

    <main>
        {% block content %}
        <!-- Main page content -->
        {% endblock %}
    </main>

    <footer>
        {% block footer %}
        <!-- Footer content -->
        {% endblock %}
    </footer>

    <!-- Chat widget container -->
    <div id="rasa-chat-widget"></div>

    <!-- Rasa Webchat Script -->
    <script>
        window.addEventListener('load', function() {
            (function(d, w, c) {
                w.RasaChatConfig = {
                    selector: "#rasa-chat-widget",
                    initPayload: "/welcome",  // Change to your desired initial intent
                    socketUrl: "http://localhost:5005",  // Ensure this points to your Rasa server's socket endpoint
                    title: "Finstock Assistant",
                    subtitle: "How can I help you today?",
                    customData: {"language": "en"},
                    params: {"storage": "session"},
		    debug: true
                };

                var s = d.createElement('script');
                s.type = 'text/javascript';
                s.async = true;
                s.src = 'https://unpkg.com/@botfront/webchat@4.1.1/dist/Webchat.js';

		s.onerror = function() {
            	    console.error('Failed to load Rasa Webchat script');
        	};

                s.onload = function() {
                    try {
                        c(w.RasaChatWidget || function() {});
                        console.log('Rasa Chat Widget loaded successfully');
                    } catch (error) {
                        console.error('Error initializing Rasa Chat Widget:', error);
                    }
                };
                var x = d.getElementsByTagName('script')[0];
                x.parentNode.insertBefore(s, x);
            })(document, window, window.RasaChatWidget || function() {});
        });
    </script>

    <!-- Additional JS scripts -->    
    {% block extra_scripts %}
    {% endblock %}
</body>
</html>
